# æºç ç®¡ç†è§„èŒƒï¼š

## ä¸€ã€åˆ†æ”¯è§„èŒƒ

æ£€æŸ¥é˜¶æ®µï¼š`pre-commit/pre-push`

> ä½¿ç”¨åˆ†æ”¯æ ¡éªŒå·¥å…· `validate-branch-name`

åˆ†æ”¯è§„èŒƒï¼š`/^(production|test|development|master){1}$|^(feature|fix|hotfix)-.+$/`

ä»…å…è®¸æäº¤çš„åˆ†æ”¯æ ¼å¼ï¼š`ä»…å…è®¸æäº¤åˆ° production, test, development, master åˆ†æ”¯, ä»¥åŠå¼€å¤´ä¸ºï¼šfeature-, fix-, hotfix- çš„åˆ†æ”¯`

1ã€å®‰è£…ä¾èµ–

```bash
npm install --save-dev validate-branch-name
```

2ã€åœ¨ package.json ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š

```json
"validate-branch-name": {
  "pattern": "^(production|test|development|master){1}$|^(feature|fix|hotfix)-.+$",
  "errorMsg": "ä»…å…è®¸æäº¤åˆ° production, test, development, master åˆ†æ”¯, ä»¥åŠå¼€å¤´ä¸ºï¼šfeature-, fix-, hotfix- çš„åˆ†æ”¯"
}
```

3ã€æ‰§è¡Œå‘½ä»¤ï¼š

```bash
npx validate-branch-name
```

## äºŒã€æäº¤è§„èŒƒ

[çº¦å®šæäº¤è¯´æ˜](https://www.conventionalcommits.org/zh-hans/v1.0.0/)ã€[è§£è¯»æ–‡ç« ](https://juejin.cn/post/6975836256441729032)

æ£€æŸ¥é˜¶æ®µï¼š`pre-commit`

> é’ˆå¯¹æäº¤çš„å†…å®¹æ£€æŸ¥ï¼Œä½¿ç”¨å·¥å…·`commitlint`

1ã€å®‰è£…ä¾èµ–

```bash
npm install --save-dev @commitlint/config-conventional @commitlint/cli
```

2ã€æ·»åŠ é…ç½®æ–‡ä»¶ï¼š[`commitlint.config.js`](https://commitlint.js.org/#/reference-configuration?id=configuration-object-example)æ”¯æŒå¤šç§æ ¼å¼ï¼Œé…ç½®æ–‡ä»¶æ ¼å¼å¯ä»¥å‚è€ƒ[cosmiconfig](https://github.com/cosmiconfig/cosmiconfig)çš„è¯´æ˜

```js
/** @type {import("@commitlint/types").UserConfig} */
module.exports = {
  extends: ["@commitlint/config-conventional"],
  rules: {
    "body-leading-blank": [2, "always"],
    "body-max-line-length": [2, "always", 10000],
    "footer-leading-blank": [2, "always"],
    "footer-max-line-length": [2, "always", 10000],
    "header-max-length": [2, "always", 100],
    "scope-case": [2, "always", "lower-case"],
    "scope-empty": [0, "always"],
    "type-empty": [0, "never"],
    "scope-max-length": [2, "never", 100],
    "type-case": [2, "always", "lower-case"],
    "type-enum": [
      2,
      "always",
      [
        "feat",
        "fix",
        "hotfix",
        "perf",
        "docs",
        "refactor",
        "chore",
        "build",
        "revert",
        "test",
        "style",
      ],
    ],
  },
  prompt: {
    // messages: {
    //   skip: "å¯ä»¥è·³è¿‡æ­¤é…ç½®",
    //   max: "æœ€å¤§å¯è¾“å…¥ %d ä¸ªå­—",
    //   min: "æœ€å°‘éœ€è¦è¾“å…¥ %d ä¸ªå­—",
    //   emptyWarning: "æ­¤é…ç½®ä¸èƒ½ä¸ºç©º\n",
    //   upperLimitWarning: "å·²è¶…å‡ºæœ€å¤§å­—ç¬¦æ•°",
    //   lowerLimitWarning: "å­—æ•°è¿‡å°‘ï¼Œè¯·é‡æ–°è¾“å…¥"
    // },
    // questions: {
    //   type: {
    //     description: "è¯·é€‰æ‹©æœ¬æ¬¡æäº¤çš„å†…å®¹ç±»å‹:",
    //     enum: {
    //       feat: {
    //         description: 'æ–°éœ€æ±‚',
    //         title: 'Features',
    //         emoji: 'âœ¨',
    //       },
    //       fix: {
    //         description: 'ä¿®å¤bug',
    //         title: 'Bug Fixes',
    //         emoji: 'ğŸ›',
    //       },
    //       docs: {
    //         description: 'åªæœ‰æ–‡æ¡£å˜æ›´',
    //         title: 'Documentation',
    //         emoji: 'ğŸ“š',
    //       },
    //       hotfix: {
    //         description: 'çº¿ä¸Šé—®é¢˜ä¿®å¤',
    //         title: 'Hot Fixes',
    //         emoji: 'ğŸ›',
    //       },
    //       style: {
    //         description: 'ä¿®æ”¹æ ·å¼',
    //         title: 'Styles',
    //         emoji: 'ğŸ’',
    //       },
    //       refactor: {
    //         description: 'ä»£ç é‡æ„',
    //         title: 'Code Refactoring',
    //         emoji: 'ğŸ“¦',
    //       },
    //       perf: {
    //         description: 'æ€§èƒ½ä¼˜åŒ–ç›¸å…³',
    //         title: 'Performance Improvements',
    //         emoji: 'ğŸš€',
    //       },
    //       test: {
    //         description: 'æµ‹è¯•ç”¨ä¾‹ç›¸å…³ä¿®æ”¹',
    //         title: 'Tests',
    //         emoji: 'ğŸš¨',
    //       },
    //       build: {
    //         description: 'å½±å“æ„å»ºç›¸å…³çš„ä¿®æ”¹',
    //         title: 'Builds',
    //         emoji: 'ğŸ› ',
    //       },
    //       ci: {
    //         description: 'CIç›¸å…³çš„ä¿®æ”¹',
    //         title: 'Continuous Integrations',
    //         emoji: 'âš™ï¸',
    //       },
    //       chore: {
    //         description: "å…¶ä»–æ‚é¡¹æ›´æ–°ï¼Œéæºä»£ç å±‚é¢çš„ä¿®æ”¹",
    //         title: 'Chores',
    //         emoji: 'â™»ï¸',
    //       },
    //       revert: {
    //         description: 'ç‰ˆæœ¬å›é€€',
    //         title: 'Reverts',
    //         emoji: 'ğŸ—‘',
    //       },
    //     },
    //   },
    //   scope: {
    //     description:
    //       'æœ¬æ¬¡å˜åŠ¨æ¶‰åŠçš„é¢†åŸŸ(å¤šä¸ªè¯·ä½¿ç”¨/æ ‡è®°)',
    //   },
    //   subject: {
    //     description: 'æœ¬æ¬¡å˜æ›´çš„ä¸»é¢˜ï¼Œç®€çŸ­æè¿°',
    //   },
    //   body: {
    //     description: 'å˜æ›´è¯¦ç»†æè¿°',
    //   },
    //   isBreaking: {
    //     description: 'æœ¬æ¬¡æ˜¯å¦æœ‰ç ´åæ€§å˜æ›´(breaking changes)?',
    //   },
    //   breakingBody: {
    //     description:
    //       'æœ¬æ¬¡ç ´åæ€§å˜æ›´(breaking changes)æè¿°',
    //   },
    //   breaking: {
    //     description: 'æè¿°è¯¦ç»†çš„ç ´åæ€§å˜åŒ–ç‚¹',
    //   },
    //   isIssueAffected: {
    //     description: 'æ˜¯å¦æœ‰å¯¹open issuesçš„ä¿®æ”¹?',
    //   },
    //   issuesBody: {
    //     description:
    //       'issuesæ”¹åŠ¨è¯¦ç»†æè¿°',
    //   },
    //   issues: {
    //     description: 'æ·»åŠ issues (å¦‚ "fix #123", "re #123".)',
    //   },
    // }
  },
};
```

3ã€æ‰§è¡Œå‘½ä»¤

```bash
npx --no -- commitlint --edit ${1}
```

### æ·»åŠ å‘½ä»¤è¡Œæäº¤æç¤º

æä¾›é˜¶æ®µ`prepare-commit-msg`

> ä½¿ç”¨å·¥å…·`commitizen`

1ã€å®‰è£…ä¾èµ–

```bash
# æ ‡å‡†çš„æç¤º
npm install --save-dev @commitlint/cz-commitlint commitizen
```

å¯ä»¥è‡ªå·±æ ¹æ®è¿™ä¸ªæ¥é…ç½®`cz-customizable`è‡ªå®šä¹‰æç¤ºé…ç½®

2ã€åœ¨`package.json`ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š

```json
"config": {
  "commitizen": {
    // æ³¨æ„å¦‚æœæ˜¯è‡ªå®šä¹‰çš„ï¼Œè¿™é‡Œé…ç½®æˆcz-customizable
    "path": "@commitlint/cz-commitlint"
  }
}
```

æˆ–è€…æ·»åŠ æŒ‡å®šçš„é…ç½®æ–‡ä»¶`.czrc`(json æ ¼å¼æ–‡ä»¶)

3ã€æ‰§è¡Œå‘½ä»¤

```bash
# æä¾›äº¤äº’ï¼Œä»…é™å‘½ä»¤è¡Œï¼Œ â€œexec < /dev/ttyâ€ä¸é€‚ç”¨äºtortoise gitå·¥å…·
exec < /dev/tty && npx cz --hook || true
```

## ä¸‰ã€ä»£ç è§„èŒƒ

æ£€æŸ¥é˜¶æ®µï¼š`pre-commit/pre-push`ï¼Œä¸€èˆ¬ä¼šå¼€å¯è‡ªåŠ¨ä¿®å¤åŠŸèƒ½ï¼Œå› æ­¤æ”¾ pre-commit é˜¶æ®µæ¯”è¾ƒåˆé€‚ï¼Œä»£ç å˜æ›´åéœ€è¦é‡æ–° commit

> js ä»£ç å·¥å…·ï¼š`eslint`

1ã€å®‰è£…ä¾èµ–

```bash
npm install --save-dev eslint
# nextjsé…ç½®çš„eslintè§„èŒƒï¼Œå‚è€ƒæ–‡æ¡£https://nextjs.org/docs/app/building-your-application/configuring/eslint
# 3åˆä¸€ï¼šnpm i --save-dev eslint-plugin-react eslint-plugin-react-hooks @next/eslint-plugin-next
# è§„åˆ™å†…å®¹ï¼šhttps://nextjs.org/docs/app/building-your-application/configuring/eslint
npm install --save-dev @next/eslint-plugin-next
# reactè§„åˆ™
npm i --save-dev eslint-plugin-react
# react-hooksè§„åˆ™
npm i --save-dev eslint-plugin-react-hooks
# prettierè§„åˆ™
npm install --save-dev eslint-config-prettier
# tsçš„è§„åˆ™
npm install --save-dev @typescript-eslint/eslint-plugin
# tsçš„è§£æï¼Œå¯¹tsçš„æ”¯æŒï¼Œé»˜è®¤eslintä¸æ”¯æŒtsï¼Œä¸è¿‡nextçš„é…ç½®å·²ç»åœ¨é‡Œé¢æ”¯æŒäº†tsï¼Œä¹Ÿå¯ä»¥ä¸é¢å¤–å®‰è£…ï¼Œå¦‚æœénexté¡¹ç›®éœ€è¦å®‰è£…
npm install --save-dev @typescript-eslint/parser
# importçš„è§„åˆ™ï¼Œæ¯”å¦‚import xx from 'xxx'å¿…é¡»è¦åœ¨æ–‡ä»¶çš„æœ€é¡¶éƒ¨
npm install eslint-plugin-import --save-dev
# importçš„typescriptæ”¯æŒï¼Œæ³¨æ„éœ€è¦åŒæ—¶é…ç½®typescript
npm i eslint-import-resolver-typescript --save-dev
```

2ã€é…ç½®æ–‡ä»¶ï¼š`.eslintrc.js`ï¼Œé…ç½®[å‚è€ƒåœ°å€](https://eslint.org/docs/latest/use/configure/)

> æ³¨æ„ä¸è¦é…ç½®`eslint.config.js`æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶æš‚æ—¶åœ¨ vscode æ’ä»¶æœ‰ bug

```js
/** @type {import('eslint').Linter.Config} */
module.exports = {
  extends: [
    // npm install --save-dev @typescript-eslint/eslint-plugin
    "plugin:@typescript-eslint/recommended",
    // npm install --save-dev eslint-config-prettier
    "prettier",
    // npm install --save-dev eslint-plugin-react
    "plugin:react/jsx-runtime",
    // npm install --save-dev @next/eslint-plugin-next
    "plugin:@next/next/recommended",
    // npm install --save-dev eslint-plugin-react-hooks
    "plugin:react-hooks/recommended",
    // npm install eslint-plugin-import --save-dev
    "plugin:import/recommended",
    // æ”¯æŒts
    "plugin:import/typescript",
  ],
  globals: {
    wx: "readonly",
  },
  settings: {
    react: {
      version: "detect",
    },
    next: {
      rootDir: ".",
    },
    "import/parsers": {
      "@typescript-eslint/parser": [".ts", ".tsx", ".mdx"],
    },
    "import/resolver": {
      typescript: true,
      node: true,
    },
  },
  // npm install --save-dev @typescript-eslint/parser
  parser: "@typescript-eslint/parser",
  plugins: ["@typescript-eslint"],
  overrides: [
    {
      files: [
        ".eslintrc.{js,cjs}",
        "**/*.tsx",
        "**/*.cjs",
        "**/*.ts",
        "**/*.mjs",
        "**/*.jsx",
        "**/*.mdx",
      ],
      rules: {
        "@typescript-eslint/no-explicit-any": "warn",
        "import/first": 2,
      },
    },
    {
      env: {
        node: true,
      },
      files: [".eslintrc.{js,cjs}"],
      parserOptions: {
        sourceType: "script",
      },
    },
  ],
  noInlineConfig: true,
};
```

3ã€æ‰§è¡Œå‘½ä»¤

```bash
npx eslint --fix -o .eslintlog
```

> æ ·å¼å·¥å…·ï¼š`stylelint`

1ã€å®‰è£…ä¾èµ–

```bash
npm install --save-dev stylelint
# æ ‡å‡†è§„èŒƒ
npm install --save-dev stylelint-config-standard
# è°ƒæ•´é¡ºåº
npm install --save-dev stylelint-config-rational-order
# sassè§„èŒƒï¼Œå¦‚æœæ˜¯ç”¨çš„sass
npm install --save-dev stylelint-config-sass-guidelines
# scssçš„æ ‡å‡†è§„èŒƒ
npm install --save-dev stylelint-config-standard-scss
# vueé£æ ¼
npm install --save-dev stylelint-config-recommended-vue
```

2ã€é…ç½®æ–‡ä»¶ï¼š`.stylelintrc.js`ï¼Œé…ç½®[å‚è€ƒåœ°å€](https://stylelint.io/user-guide/get-started)

```js
/** @type {import('stylelint').Config} */
module.exports = {
  extends: [
    // æ ‡å‡†çš„æ ·å¼è§„èŒƒ
    "stylelint-config-standard",
    "stylelint-config-standard-scss",
    // sass guideline sass-guidelin.es.
    "stylelint-config-sass-guidelines",
    // Sorts related property declarations by grouping together in the rational order.https://github.com/constverum/stylelint-config-rational-order
    "stylelint-config-rational-order",
  ],
  overrides: [
    // lessæ”¯æŒï¼Œéœ€è¦å®‰è£…postcss-less
    // {
    //   files: [
    //     '**/*.less'
    //   ],
    //   customSyntax: 'postcss-less',
    // },
    // æ”¯æŒhtmlï¼Œvueä½¿ç”¨stylelint-config-recommended-vue
    // {
    //   files: [
    //     '**/*.vue',
    //     '**/*.astro',
    //     '**/*.html'
    //   ],
    //   customSyntax: 'postcss-html',
    // }
  ],
};
```

3ã€æ‰§è¡Œå‘½ä»¤

```bash
npx stylelint --fix
```

## å››ã€æ“ä½œæ­¥éª¤

### 1. å®‰è£… husky

```bash
npm i husky --save-dev
# ä¼šå°†git hookè®¾ç½®ä¸º.huskyï¼Œç„¶åå¯ä»¥åœ¨.huskyå†™git hook
npx husky install
```

husky ç›®å½•ç»“æ„ï¼š

```bash
.husky
â””â”€â”€ pre-commit  å¯¹åº”gitçš„pre-commit
â””â”€â”€ commit-msg  å¯¹åº”gitçš„commit-msg
â””â”€â”€ post-commit  å¯¹åº”gitçš„post-commit
â””â”€â”€ pre-rebase  å¯¹åº”gitçš„pre-rebase
â””â”€â”€ prepare-commit-msg  å¯¹åº”gitçš„prepare-commit-msg
â””â”€â”€ pre-push  å¯¹åº”gitçš„pre-push
```

ä¸€èˆ¬è¿™æ ·é…ç½®`husky`å‘½ä»¤:

```bash
# è¿™æ ·æ“ä½œä¼šè‡ªåŠ¨æ·»åŠ huskyçš„å‘½ä»¤æ ¼å¼
npx husky add .husky/pre-commit "npx --no -- commitlint --edit ${1}"
```

é…ç½®å®Œæˆçš„`.husky/pre-commit`æ–‡ä»¶å¦‚ä¸‹ï¼š

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npx --no -- commitlint --edit ${1}
```

é…ç½®å®Œæˆåï¼Œä½ ä¹Ÿå¯ä»¥æŒ‰ç…§è‡ªå·±çš„è¦æ±‚ä¿®æ”¹ï¼Œä¿ç•™ä¸Šé¢çš„å‰ 2 è¡Œå†…å®¹å³å¯ï¼Œä¸‹é¢æ¯è¡Œå¯ä»¥è‡ªå·±åŠ å‘½ä»¤

### 2. é…ç½® git hooks

2.1ã€é¢„æäº¤é˜¶æ®µï¼š`.husky/pre-commit`

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"
# æ£€æŸ¥åˆ†æ”¯åç§°
npx validate-branch-name
# ä»£ç æ£€æŸ¥
npx eslint --fix
```

2.2ã€æäº¤å‡†å¤‡é˜¶æ®µï¼š`.husky/prepare-commit-msg`

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# æä¾›äº¤äº’ï¼Œä»…é™å‘½ä»¤è¡Œï¼Œ â€œexec < /dev/ttyâ€ä¸é€‚ç”¨äºtortoise gitå·¥å…·
exec < /dev/tty && npx cz --hook || true
```

2.3ã€é¢„æäº¤é˜¶æ®µï¼š`.husky/commit-msg`

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"


# æ£€æŸ¥æäº¤ä¿¡æ¯
npx --no -- commitlint --edit ${1}
```

2.4ã€é¢„æ¨é€é˜¶æ®µï¼š`.husky/pre-push`

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# æ£€æŸ¥ä»£ç 
npx eslint --fix
```

ä»¥ä¸Šé˜¶æ®µå†…å®¹éƒ½å¯ä»¥é€šè¿‡`husky`æ¥æ·»åŠ ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```bash
npx husky add .husky/GITé’©å­åç§° "éœ€è¦æ‰§è¡Œçš„å‘½ä»¤"
```

## äº”ã€æ’ä»¶æ¨è

### ä»¥ä¸‹æ’ä»¶åœ¨æ‰“å¼€é¡¹ç›®æ—¶ä¼šè‡ªåŠ¨æ¨èï¼Œå¯ä¸€é”®å®‰è£…ï¼š

```json
{
  "recommendations": [
    // ç»Ÿä¸€ç¼–è¾‘å™¨é…ç½®https://editorconfig.org/
    "editorconfig.editorconfig",
    // eslint https://eslint.org/
    "dbaeumer.vscode-eslint",
    // eslintä¸­æ–‡è§„åˆ™è¯´æ˜
    "maggie.eslint-rules-zh-plugin",
    // prettier https://prettier.io/
    "esbenp.prettier-vscode",
    // æ ‡ç­¾è‡ªåŠ¨é—­åˆ
    "formulahendry.auto-close-tag",
    // æ ‡ç­¾è‡ªåŠ¨é‡å‘½å
    "formulahendry.auto-rename-tag",
    // æ³¨é‡Šæ’ä»¶, å¯ä»¥é«˜äº®å„ç§æ³¨é‡Š
    "aaron-bond.better-comments",
    // vscodeç®€ä½“ä¸­æ–‡
    "MS-CEINTL.vscode-language-pack-zh-hans",
    // æ³¨é‡Šé”šç‚¹ï¼Œä¾‹å¦‚// TODOï¼Œåœ¨ä»£ç é‡Œé¢é…ç½®åå¯ä»¥åœ¨ä¾§è¾¹æ å¿«é€Ÿå®šä½åˆ°å¤‡æ³¨
    "Gruntfuggly.todo-tree",
    // ç¿»è¯‘æ³¨é‡Šï¼Œé¼ æ ‡æ”¾è‹±æ–‡æ³¨é‡Šä¸Šä¼šç›´æ¥ç¿»è¯‘ä¸­æ–‡ï¼Œå¯ä»¥ä¸­è‹±å¯¹ç…§
    "intellsmi.comment-translate",
    // Materialå›¾æ ‡ä¸»é¢˜
    "PKief.material-icon-theme",
    // æ‰“å¼€å¤šä¸ªvscodeå¯ä»¥åˆ†é¢œè‰²ï¼Œè¿™æ ·å°±ä¸æ€•æä¸æ¸…æ¥šæ‰“å¼€çš„æ˜¯å“ªä¸ªäº†
    "stuart.unique-window-colors",
    // é˜¿é‡Œé€šä¹‰çµç ä»£ç æç¤ºæ’ä»¶
    "Alibaba-Cloud.tongyi-lingma",
    // æ‹¼å†™æ£€æŸ¥
    "streetsidesoftware.code-spell-checker",
    // ä»£ç å¤æ‚åº¦ç»Ÿè®¡
    "kisstkondoros.vscode-codemetrics",
    // æ­£åˆ™è¡¨è¾¾å¼é¢„è§ˆ
    "chrmarti.regex",
    // stylelint https://stylelint.io/
    "stylelint.vscode-stylelint",

    // ä»¥ä¸‹ä¸ºåˆé›†
    // å¤šåˆä¸€æ‰©å±•ï¼Œå¯ä»¥æ ¹æ®è¿™é‡Œçš„å¤šä¸ªåŒ…é€‰æ‹©å®‰è£…
    "SeyyedKhandon.zpack",
    // ã€Né€‰å¤šã€‘å‰ç«¯æ‰©å±•åŒ…åˆé›†
    "SeyyedKhandon.fpack",
    //  ã€Né€‰å¤šã€‘è§†è§‰å±‚é¢çš„æ‰©å±•åˆé›†
    "SeyyedKhandon.epack"
  ]
}
```

### ä»¥ä¸‹ä¸ºåˆé›†ï¼Œæ”¶å½•äº†å¾ˆå¤šå®ç”¨çš„æ’ä»¶ï¼Œå¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©å®‰è£…ï¼š

```json
{
  "recommendations": [
    // ä»¥ä¸‹ä¸ºåˆé›†
    // å¤šåˆä¸€æ‰©å±•ï¼Œå¯ä»¥æ ¹æ®è¿™é‡Œçš„å¤šä¸ªåŒ…é€‰æ‹©å®‰è£…
    "SeyyedKhandon.zpack",
    // ã€Né€‰å¤šã€‘å‰ç«¯æ‰©å±•åŒ…åˆé›†
    "SeyyedKhandon.fpack",
    //  ã€Né€‰å¤šã€‘è§†è§‰å±‚é¢çš„æ‰©å±•åˆé›†
    "SeyyedKhandon.epack"
  ]
}
```
